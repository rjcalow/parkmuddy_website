<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Is Clumber Park muddy?</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description"
        content="A simple mud estimate for Clumber Park based on recent Environment Agency rainfall data.">

  <style>
    :root {
      --bg: #ffffff;
      --text: #111111;
      --muted: #666666;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0e0f12;
        --text: #f2f4f8;
        --muted: #aab3c2;
      }
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    main {
      max-width: 680px;
      padding: 24px 18px 40px;
      margin: 0 auto;
    }

    h1 {
      font-size: clamp(36px, 8vw, 64px);
      line-height: 1.05;
      margin: 0 0 12px 0;
      letter-spacing: -0.02em;
    }

    p {
      font-size: 16px;
      line-height: 1.6;
      margin: 12px 0;
    }

    .status {
      font-weight: 800;
    }

    .muted {
      color: var(--muted);
      font-size: 14px;
    }

    footer {
      margin-top: 32px;
      border-top: 1px solid color-mix(in srgb, var(--text) 10%, transparent);
      padding-top: 16px;
    }

    a {
      color: inherit;
      text-decoration: underline;
      text-underline-offset: 3px;
    }
  </style>
</head>

<body>
<main>

  <h1 id="headline">Loading…</h1>

  <p class="status" id="summary">—</p>

  <p id="details">—</p>

  <p class="muted" id="updated">Updated: —</p>

  <footer>
    <p class="muted">
      Based on recent rainfall near Clumber Park using the UK Environment Agency
      flood-monitoring API.
    </p>
    <p class="muted">
      <a href="/api">View raw data</a>
    </p>
  </footer>

</main>

<script>
  const API_URL = "/api";

  function mudFrom(r24, r72) {
    // Simple, readable logic — tune later if needed
    const mudIndex = Math.min(100, (r72 * 2) + (r24 * 4));

    if (mudIndex <= 20) {
      return {
        headline: "Not muddy",
        summary: "Ground should be firm on most paths.",
      };
    }

    if (mudIndex <= 45) {
      return {
        headline: "A bit muddy",
        summary: "Some soft ground, especially off main paths.",
      };
    }

    if (mudIndex <= 70) {
      return {
        headline: "Muddy",
        summary: "Expect mud on woodland trails. Boots recommended.",
      };
    }

    return {
      headline: "Very muddy",
      summary: "Wet ground and puddles likely. Boots or wellies advised.",
    };
  }

  function fmt(n) {
    return Number.isFinite(n) ? n.toFixed(1) : "—";
  }

  function safeTime(iso) {
    try { return new Date(iso).toLocaleString(); }
    catch { return iso || "—"; }
  }

  async function load() {
    try {
      const res = await fetch(API_URL);
      if (!res.ok) throw new Error("API error " + res.status);

      const data = await res.json();
      if (!data.ok) throw new Error("API returned ok=false");

      const r24 = Number(data.rain_24h_mm);
      const r72 = Number(data.rain_72h_mm);

      const mud = mudFrom(
        Number.isFinite(r24) ? r24 : 0,
        Number.isFinite(r72) ? r72 : 0
      );

      document.getElementById("headline").textContent = mud.headline;
      document.getElementById("summary").textContent = mud.summary;

      document.getElementById("details").textContent =
        `Rainfall: ${fmt(r24)} mm in the last 24 hours, ` +
        `${fmt(r72)} mm in the last 72 hours.`;

      document.getElementById("updated").textContent =
        "Updated: " + safeTime(data.builtAt || data.latest_reading);

    } catch (err) {
      console.error(err);
      document.getElementById("headline").textContent = "Unavailable";
      document.getElementById("summary").textContent =
        "Could not load rainfall data at the moment.";
      document.getElementById("details").textContent = "";
    }
  }

  load();
</script>
</body>
</html>

